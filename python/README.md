# Python Video Processing

なんJ野球動画自動生成システムのPython動画処理コンポーネントです。

## 概要

MoviePyを使用した高品質動画生成システム。音声、字幕、背景素材を合成して最終的な動画ファイルを生成します。

## 依存関係

```bash
pip install -r python/requirements.txt
```

### 主要ライブラリ

- **MoviePy**: 動画編集・合成のメインライブラリ
- **NumPy**: 数値計算・配列操作
- **Pillow**: 画像処理（字幕・背景）
- **OpenCV**: 動画処理・背景生成
- **librosa**: 音声処理・分析
- **scipy**: 画像フィルタ・エフェクト

## 機能

### 1. 背景生成
- 野球場風グラデーション背景
- 夜間球場背景
- カスタム背景画像・動画の読み込み

### 2. 字幕合成
- PNG字幕画像の配置・サイズ調整
- 画面下部中央配置
- 透明度・位置の自動調整

### 3. GIF統合
- 感情分析に基づくGIF選択
- オーバーレイ配置・透明度調整
- サイズ・位置の自動調整

### 4. 音声合成
- VoiceVox音声 + BGMの自動ミックス
- ボリューム自動調整
- ループ再生対応

### 5. 高品質出力
- 1920x1080, 30fps
- H.264/AAC エンコード
- 最適化されたプリセット

## 使用方法

### 直接実行（デバッグ用）

```bash
cd python
python enhanced_video_generator.py <audio_dir> <subtitle_dir> <output_dir> <assets_info_json>
```

### Node.jsから実行（推奨）

```bash
# 完全自動化パイプライン
node scripts/generate-full-pipeline.mjs --sites

# 動画のみ生成
node scripts/generate-video-batch.mjs
```

## システム要件

- Python 3.8以上
- 十分なメモリ（動画処理のため）
- 十分なディスク容量（出力動画用）

## パフォーマンス

- **処理能力**: 15-30秒/動画（システム性能による）
- **メモリ使用量**: 1-2GB（同時処理動画数による）
- **出力品質**: プロフェッショナル品質

## トラブルシューティング

### よくある問題

1. **依存関係エラー**
   ```bash
   pip install --upgrade moviepy numpy pillow opencv-python
   ```

2. **メモリ不足**
   - 同時処理数を減らす
   - より大きなメモリ環境で実行

3. **エンコードエラー**
   - ffmpegの更新
   - 一時ファイル削除

### ログ確認

詳細なエラー情報はコンソール出力で確認できます。

## 開発者向け

### カスタム背景追加

`create_background_clip()`関数を修正して新しい背景タイプを追加可能。

### エフェクト追加

MoviePyのエフェクトライブラリを使用してカスタムエフェクトを追加可能。

### パフォーマンス最適化

- プリセット変更
- 解像度調整
- フレームレート調整

## ライセンス

MITライセンス